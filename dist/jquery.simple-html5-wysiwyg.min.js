/*
 *  jquery.simple-html5-wysiwyg - v0.0.1
 *  Simple jQuery WYSIWYG Plugin
 *  https://github.com/Iwark/jquery.simple-html5-wysiwyg
 *
 *  Made by Iwark <iwark02@gmail.com>
 *  Under MIT License
 */
(function(){var a,b;a=function(){function a(a,d){this.element=a,this.settings=$.extend({},c,d),this.toolbar=new b(this.settings.commands,this.settings.bootstrap),this.init()}var c;return c={bootstrap:!1,commands:["bold","color","background-color","underline","link","border","image","movie"],imageUploadTo:""},a.prototype.init=function(){return $(this.element).hide(),$(this.element).before($(this.toolbar.element)),$(this.element).before($("<article class='sh5wysiwyg-article' contentEditable='true'></article>"))},a.prototype.execCommand=function(a){var b,c,d,e,f,g,h,i,j,k;switch(a){case"bold":if(document.getSelection().toString().length>0)return document.execCommand("bold",!1);break;case"color":if(document.getSelection().toString().length>0)return b=$(document.getSelection().anchorNode.parentNode),e=prompt("Color:",b.css("color")),""===e?document.execCommand("removeFormat",!1,"foreColor"):document.execCommand("foreColor",!1,e);break;case"background-color":if(document.getSelection().toString().length>0)return b=$(document.getSelection().anchorNode.parentNode),c=prompt("Background Color:",b.css("background-color")),""===c?b.css("background-color",""):document.execCommand("backColor",!1,c);break;case"underline":if(document.getSelection().toString().length>0)return document.execCommand("underline",!1);break;case"link":if(document.getSelection().toString().length>0)return k=prompt("URL:"),""===k?document.execCommand("unlink",!1):document.execCommand("createLink",!1,k);break;case"border":if(i=document.getSelection(),i.toString().length>0)return b=$(i.anchorNode.parentNode),$(i.anchorNode.parentNode).css(b.hasClass("sh5wysiwyg-frame")?{display:"block",border:"none",padding:0,margin:0}:{display:"inline-block",border:"1px solid #777",padding:"4px",margin:"4px"}),b.toggleClass("sh5wysiwyg-frame");break;case"image":return $(".sh5wysiwyg-file:first").trigger("click");case"movie":if(k=prompt("URL:",""),k&&k.match(/^http:\/\/(?:www\.nicovideo\.jp\/watch|nico\.ms)\/[a-z][a-z](\d+)/))return g=RegExp.$1,f=parseInt(g)%4+1,j="http://tn-skr"+f+".smilevideo.jp/smile?i="+g,h="<img class='sh5wysiwyg-niconico' src='"+j+"' data-url='"+k+"'>",document.execCommand("insertHTML",!1,h);break;case"class":if(i=document.getSelection(),i.toString().length>0)return d=prompt("Class Name:",i.anchorNode.parentNode.className),i.anchorNode.parentNode.className=d}},a}(),b=function(){function a(a,b){this.commands=a,this.bootstrap=b,this.element="<div class='sh5wysiwyg-toolbar'>",this.bootstrapBtn=this.bootstrap?" class='btn btn-default'":"",this.init()}return a.prototype.init=function(){var a,b,c,d;for(d=this.commands,b=0,c=d.length;c>b;b++)a=d[b],this.element+="<input type='button' value='"+a+"'"+this.bootstrapBtn+">";return $.inArray("image",this.commands)&&(this.element+="<input type='file' class='sh5wysiwyg-file' style='position: absolute; top: -50px; left: 0; width: 0; height: 0; opacity: 0; filter: alpha(opacity=0);'>"),this.element+="</div>"},a}(),function(b){var c;return c="sh5wysiwyg",b.fn[c]=function(d){return this.each(function(){return b.data(this,c)?void 0:(b(this).addClass(c),b.data(this,c,new a(this,d)))}),b(".sh5wysiwyg-article").on("focus",function(){var a,c,d;return d=document.getSelection(),!b(this).html()&&(a=b("<div></div>"),b(this).html(a),c=document.createRange(),c.selectNode(a[0]),d.addRange(c),b(this).html(""),document.execCommand("insertParagraph",!1,null),b(this).find("div").length>1)?b(this).find("div:first").remove():void 0}),b(".sh5wysiwyg-toolbar > input").on("click",function(){var a,d;return a=b(this).parent().nextAll("."+c+":first"),d=b.data(a[0],c),d.execCommand(b(this).val())}),b(".sh5wysiwyg-file").on("change",function(a){var c;if(document.getSelection().toString().length>0)return a.preventDefault(),c=new FormData,c.append("file",this.files[0]),b.ajax({url:d.imageUploadTo,type:"POST",data:c,processData:!1,contentType:!1,success:function(a){return document.execCommand("insertImage",!1,a)},error:function(a){return alert("Error: "+a)}})})}}(jQuery)}).call(this);