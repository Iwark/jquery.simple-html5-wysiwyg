/*
 *  jquery.simple-html5-wysiwyg - v0.0.8
 *  Simple jQuery WYSIWYG Plugin
 *  https://github.com/Iwark/jquery.simple-html5-wysiwyg
 *
 *  Made by Iwark <iwark02@gmail.com>
 *  Under MIT License
 */
(function(){var a,b;a=function(){function a(a,d){this.element=a,this.settings=$.extend({},c,d),this.toolbar=new b(this.settings.commands,this.settings.bootstrap),this.bootstrapClass=this.settings.bootstrap?" form-control":"",this.init()}var c;return c={bootstrap:!1,commands:["font-size","bold","color","background-color","underline","link","border","image","movie"],minFontSize:12,maxFontSize:20,imageUploadTo:""},a.prototype.init=function(){return $(this.element).hide(),$(this.element).before($(this.toolbar.element)),$(this.element).before($("<article class='sh5wysiwyg-article"+this.bootstrapClass+"' contentEditable='true'>"+$(this.element).val()+"</article>"))},a.prototype.execCommand=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;switch(p=document.getSelection(),j=p.toString().length>0,j&&(n=p.anchorNode.parentNode,o=n.nodeName.toLowerCase()),a){case"font-size":if(j&&(e=parseInt(prompt("Font Size (1-7):")),document.execCommand("fontSize",!1,e),l=document.getSelection().anchorNode.parentNode,m=l.nodeName.toLowerCase(),i=Math.round((this.settings.maxFontSize-this.settings.minFontSize)/6*100)/100,k=this.settings.minFontSize+i*(e-1),"font"===m))return $(l).removeAttr("size").css("font-size",k+"px");break;case"bold":if(j)return document.execCommand("bold",!1);break;case"color":if(j)if(d="font"===o?$(n).css("color"):"",c=prompt("Color:",d),""===c){if("font"===o)return $(n).css("color","")}else if(document.execCommand("foreColor",!1,c),l=document.getSelection().anchorNode.parentNode,m=l.nodeName.toLowerCase(),"font"===m)return $(l).removeAttr("color").css("color",c);break;case"background-color":if(j)return b=prompt("Background Color:",$(n).css("background-color")),""===b?$(n).css("background-color",""):document.execCommand("backColor",!1,b);break;case"underline":if(j)return document.execCommand("underline",!1);break;case"link":if(j)return r=prompt("URL:"),""===r?document.execCommand("unlink",!1):document.execCommand("createLink",!1,r);break;case"border":if(j)return $(n).css($(n).hasClass("sh5wysiwyg-frame")?{display:"block",border:"none",padding:0,margin:0}:{display:"inline-block",border:"1px solid #777",padding:"4px",margin:"4px"}),$(n).toggleClass("sh5wysiwyg-frame");break;case"image":return $(".sh5wysiwyg-file:first").trigger("click");case"movie":if(r=prompt("URL:",""),r&&r.match(/^http:\/\/(?:www\.nicovideo\.jp\/watch|nico\.ms)\/[a-z][a-z](\d+)/))return g=RegExp.$1,f=parseInt(g)%4+1,q="http://tn-skr"+f+".smilevideo.jp/smile?i="+g,h="<img class='sh5wysiwyg-niconico' src='"+q+"' data-url='"+r+"'>",document.execCommand("insertHTML",!1,h);break;case"class":if(j)return n.className=prompt("Class Name:",n.className)}},a}(),b=function(){function a(a,b){this.commands=a,this.bootstrap=b,this.element="<div class='sh5wysiwyg-toolbar'>",this.bootstrapBtn=this.bootstrap?" class='btn btn-default'":"",this.init()}return a.prototype.init=function(){var a,b,c,d;for(d=this.commands,b=0,c=d.length;c>b;b++)a=d[b],this.element+="<input type='button' value='"+a+"'"+this.bootstrapBtn+">";return $.inArray("image",this.commands)&&(this.element+="<input type='file' class='sh5wysiwyg-file' style='position: absolute; top: -50px; left: 0; width: 0; height: 0; opacity: 0; filter: alpha(opacity=0);'>"),this.element+="</div>"},a}(),function(b){var c;return c="sh5wysiwyg",b.fn[c]=function(d){return this.each(function(){return b(this).data(c)?void 0:(b(this).addClass(c),b(this).data(c,new a(this,d)))}),b(".sh5wysiwyg-article").off("focus").on("focus",function(){var a,c,d;return d=document.getSelection(),d.anchorNode===this&&!b(this).html()&&(a=b("<div></div>"),b(this).html(a),c=document.createRange(),c.selectNode(a[0]),d.addRange(c),b(this).html(""),document.execCommand("insertParagraph",!1,null),b(this).find("div").length>1)?b(this).find("div:first").remove():void 0}),b(".sh5wysiwyg-toolbar > input").off("click").on("click",function(){var a,d;return a=b(this).parent().nextAll("."+c+":first"),d=a.data(c),d.execCommand(b(this).val())}),b(".sh5wysiwyg-file").off("change").on("change",function(a){var c;if(!(document.getSelection().toString().length>0))return a.preventDefault(),c=new FormData,c.append("file",this.files[0]),b.ajax({url:d.imageUploadTo,type:"POST",data:c,processData:!1,contentType:!1,dataType:"json",success:function(a){return document.execCommand("insertImage",!1,a.url)},error:function(a,b,c){return alert("Error textStatus:"+b+", errorThrown:"+c)}})})}}(jQuery)}).call(this);